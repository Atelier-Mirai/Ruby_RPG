---
title: "Ruby で創る RPG 第九章 勇者が回復できるようにする"
emoji: "🍍"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Ruby", "初心者", "コンピュータ", "計算機科学", "プログラミング"]
published: true
published_at: 2024-01-18 06:00
---

<!-- １２３４５６７８９０１２３４５６７８９-->
<!-- 🍇🍈🍉🍊🍋🍌🍍🥭🍎🍏🍐🍑🍒🍓🫐🫑🥝🍅🫒🥥 -->

## gets メソッドで、キー入力を受け取る
「とてもよくできたわね。 勇者が攻撃して、スライムが反撃してきて、どちらか死んだらメッセージを表示して終わるのね。」
「うん、そうなんだ。そしてね、勇者が死にそうになったときに、このまま死んじゃうんじゃなくて、回復できるようにしたいんだけれど、どうしたらいいのかな？」
「そうね。勇者が弱ってきている時に、そのまま攻め続けてスライムを倒せればいいけれど、失敗したら死んでしまうものね。攻撃するか、回復するか、次の行動を選択できるようにするといいわよね。」

「うん、そうだね。どうやったらできるの？」
「そうね〜、みっくんはどうやったらできると思う？」
「1番なら攻撃、2番なら回復、3番なら逃げるって、コマンドを表示するのはどうかな〜」
「それはとってもいい考えね。じゃあ早速書いてみましょうか。」
「うん。 画面に攻撃、回復、逃走って出すのは、```puts "1: 攻撃"``` って書けばいいんだよね。」
「ええ、その通りよ。」
「1番を押されたらっていうのはどうやったらいいの？」
「キーボードからの入力を受け取るためのメソッドもいろいろあるけれど、基本となるのは、```gets```メソッドを使うといいわ。getは得るっていう意味の英単語で、sはString文字列の略ね。」
「あ〜、これ、いままでも登場してきているよ。」
「そうね。エンターキーを押したら次の画面が表示されるようにしたのよね。」
「うん、そうなんだ。」
「ケンタッキーの時には、特に入力された文字を処理する必要がなかったから、とだけ書いたんだけれど、次のように書けば、入力された文字を受け取ることもできるわ。」

```ruby:gets.rb
puts "1: 攻撃"
puts "2: 回復"
puts "3: 逃走"
command = gets.chomp
puts command
```

「```gets```関数で受け取った値を```menu```という変数に代入して、```puts```関数で表示させているんだね。」
「ええ、そうよ。」
「で、```gets```の後ろについている ```chomp```って何？」
「あ〜、これね。chomp は、音を立てて噛む、噛み切るなんて意味の英単語なんだけれど、改行文字を削除するメソッドなの。」
「かいぎょうもじ？」
「改行文字って、キーボードから文字を入力じゃない。例えば、この場合だったら ```1```というキーとエンターキーを押すわよね。そうすると目には見えないけれども、このエンターキーを押したことで改行文字って言うのだけれど、この文字も一緒にキーボードから読み取られるの。」
「ふーん、そうなんだ〜」
「えー、そうするとね、そのままメニューを画面に表示してしまうと、1のほかに改行文字も表示されてしまうわ。」
「あ〜。それで、chompメソッドを使うと、その改行文字を取り除いてくれるんだね。」
「ええ、そうよ。みっくん、飲み込みが早くて助かるわ。」

ここ数日、大好きな遙香お姉さまに教えて、僕もプログラミングセンスが身についてきたみたい。

「じゃあ、ちょっと実験してみようか。```gets.rb```ってファイルを作って。さっきのコードを書くの。そしたら、```ruby gets.rb```って、ターミナル画面からコマンド入力すると実行できるわ。」

さっそく、僕は実行して見た。
1番攻撃を指示したいので、キーボードから```1```って入力して、エンターキーを押して実行。
無事に、動いているみたいだ。
![](https://storage.googleapis.com/zenn-user-upload/665e3d738fc8-20240117.png)


## .to_i メソッドで、数値に変換する。

### バグ？？？
「遙香さん、動いたよ〜」
「良かったわね♡」
「じゃあ、続きも書いて見るね。」

動いていることが確認できたので、僕はコマンドに応じた処理を書いていく。
```case```文を使うとすっきり書けそうだ。

```ruby:gets.rb
# コマンドを表示する
puts "1: 攻撃"
puts "2: 回復"
puts "3: 逃走"

# キーボードからの入力を受け取って、改行文字を噛みちぎる。
command = gets.chomp
puts command

# コマンドに応じた処理
case command
when 1
  puts "勇者の攻撃"
when 2
  puts "勇者は回復呪文を唱えた"
when 3
  puts "勇者は逃げ出した"
end
```

出来上がったので、実行させて見る。が・・・、結果は先ほどと変わらない。

「遙香さん、1番だったら攻撃、2番だったら回復って書いて見たんだけれど、動かないんだ〜。エラーは出ていないようだし、どうしてなんだろう？ 何か、間違っているのかな〜？」

「ええ、エラーが出ていないし、```Ruby```の文法としては間違ってはいないわ。そしてみっくんが思ったようには、意図したようには動いていないわよね。いわゆるバグって呼ばれるやつだわね。」
「バグって何？」
「ちょっとしたプログラムの不具合のことを言うのだけれど、英語ではbug、文字通り虫の事よ。昔々のコンピュータは、様々な回路を配線でつないでいたことは話したわよね。」
「うん、そこから今のMacBook Airまでたくさんの人が進歩させてきたんだよね。」
「ええ、そうね。そしてね、うまく動かなかったので繋いだ電気回路を調べてみたんだって。そしたらね、一匹の蛾が回路に挟まっていたそうなの。」
「へ〜。そうなんだ。」
「ええ、いまでも標本になって残っているそう。そこからうまく動かない不具合のことをバグって名付けられたそうよ。バグがいるって、不具合の原因となる虫が回路中のどこかにいるっていうことなのね。」
「へー、そうなんだー。じゃあこの場合もどこかにバグがいるんだね。」
「そうね、今はもう物理的に線をつないだりはしないから、Macの中に虫がいるってわけではないけれど。」
そう言ってお姉さまは笑う。そしてお姉様の冗談に、僕も一緒になって笑う。笑っている顔も綺麗だし、口元からのぞく白い歯も素敵だ。

「そして、良くある、ほんとに良くあることなのだけれど、文字列としての```"1"```と数値としての```1```との違いを理解するのは大切だわ。」
「どういうこと？」
「う〜ん、そうねぇ。例えば漢数字の```一```と、算用数字の```1```の違いはわかる？」
「うん、漢数字の一は漢字で、算用数字は計算に用いる数字って言うくらいだし、普通に計算に使う数字のことだよね。」
「ええ、そうよ。例えば一生懸命とかとは書くけれど、1生懸命って書いたら変だよね。」
「うん、そうだね。」
「文章中に書く数字のときには漢数字の一を使うわ。そして計算で使うときには算用数字の1を使う。これが普通だわよね。」
「うん、そうだね。」
「コンピュータもそれと一緒で、文字列としての```"1"```と計算に使う数値としての```1```というのは区別されているの。」
「そうなんだ〜。」
「ええ、```Ruby```をはじめとして多くのプログラミング言語では、文字列を""(ダブルコーテーション)で、囲むわ。だからあたしも文字列としての```"1"```と計算に使う数値としての```1```と書くわね。」


### アスキーコード

「これはアスキーコード表といって、文字と文字に割り当てられた番号との対応表なの。Dec は十進数、Hex は十六進数、Char は文字のことね。」

| Dec | Hex | Char | Dec | Hex | Char | Dec | Hex | Char | Dec | Hex | Char |
|-----|-----|------|-----|-----|------|-----|-----|------|-----|-----|------|
|  0  |  00 | NUL  | 32  |  20 |      | 64  |  40 | @    | 96  |  60 | `    |
|  1  |  01 | SOH  | 33  |  21 | !    | 65  |  41 | A    | 97  |  61 | a    |
|  2  |  02 | STX  | 34  |  22 | "    | 66  |  42 | B    | 98  |  62 | b    |
|  3  |  03 | ETX  | 35  |  23 | #    | 67  |  43 | C    | 99  |  63 | c    |
|  4  |  04 | EOT  | 36  |  24 | $    | 68  |  44 | D    |100  |  64 | d    |
|  5  |  05 | ENQ  | 37  |  25 | %    | 69  |  45 | E    |101  |  65 | e    |
|  6  |  06 | ACK  | 38  |  26 | &    | 70  |  46 | F    |102  |  66 | f    |
|  7  |  07 | BEL  | 39  |  27 | '    | 71  |  47 | G    |103  |  67 | g    |
|  8  |  08 | BS   | 40  |  28 | (    | 72  |  48 | H    |104  |  68 | h    |
|  9  |  09 | HT   | 41  |  29 | )    | 73  |  49 | I    |105  |  69 | i    |
| 10  |  0A | LF   | 42  |  2A | *    | 74  |  4A | J    |106  |  6A | j    |
| 11  |  0B | VT   | 43  |  2B | +    | 75  |  4B | K    |107  |  6B | k    |
| 12  |  0C | FF   | 44  |  2C | ,    | 76  |  4C | L    |108  |  6C | l    |
| 13  |  0D | CR   | 45  |  2D | -    | 77  |  4D | M    |109  |  6D | m    |
| 14  |  0E | SO   | 46  |  2E | .    | 78  |  4E | N    |110  |  6E | n    |
| 15  |  0F | SI   | 47  |  2F | /    | 79  |  4F | O    |111  |  6F | o    |
| 16  |  10 | DLE  | 48  |  30 | 0    | 80  |  50 | P    |112  |  70 | p    |
| 17  |  11 | DC1  | 49  |  31 | 1    | 81  |  51 | Q    |113  |  71 | q    |
| 18  |  12 | DC2  | 50  |  32 | 2    | 82  |  52 | R    |114  |  72 | r    |
| 19  |  13 | DC3  | 51  |  33 | 3    | 83  |  53 | S    |115  |  73 | s    |
| 20  |  14 | DC4  | 52  |  34 | 4    | 84  |  54 | T    |116  |  74 | t    |
| 21  |  15 | NAK  | 53  |  35 | 5    | 85  |  55 | U    |117  |  75 | u    |
| 22  |  16 | SYN  | 54  |  36 | 6    | 86  |  56 | V    |118  |  76 | v    |
| 23  |  17 | ETB  | 55  |  37 | %    | 87  |  57 | W    |119  |  77 | w    |
| 24  |  18 | CAN  | 56  |  38 | &    | 88  |  58 | X    |120  |  78 | x    |
| 25  |  19 | EM   | 57  |  39 | '    | 89  |  59 | Y    |121  |  79 | y    |
| 26  |  1A | SUB  | 58  |  3A | :    | 90  |  5A | Z    |122  |  7A | z    |
| 27  |  1B | ESC  | 59  |  3B | ;    | 91  |  5B | [    |123  |  7B | {    |
| 28  |  1C | FS   | 60  |  3C | <    | 92  |  5C | \    |124  |  7C | |    |
| 29  |  1D | GS   | 61  |  3D | =    | 93  |  5D | ]    |125  |  7D | }    |
| 30  |  1E | RS   | 62  |  3E | >    | 94  |  5E | ^    |126  |  7E | ~    |
| 31  |  1F | US   | 63  |  3F | ?    | 95  |  5F | _    |127  |  7F | DEL  |


「一つ一つの文字に数値が割り振られているんだね。」
「ええ。例えばアルファベットのAだったら41、10進数にすると65と言うふうに番号が割り振られているの。」
「そうなんだね〜。」
「だから、人から見るとアルファベットのAと言う文字なんだけれど、コンピュータの内部では65番だって扱っているの。」
「そうなんだね。」
「数値の1っていくつだと思う。」
「16進数で31、10進数だと49だよ。」
「ええ、そうね。なので、キーボードから入力された```"1"```と言う文字なんだけれど、コンピュータの中では49って言う数字としての扱いになっているの。だからこれを文字としての```"1"```ではなくて数値としての```1```だよって、変換してあげる必要があるわ。」
「うん、そうだね。何かきっと変換するために便利なコマンドが用意されているんだよね。」
「ええ、みっくん賢いわね。```Ruby```では ```to_i```と言うメソッドを使うと、文字列をに変換することができるわ。```i```は```integer``` 整数の ```i``` ね。」

「そうか〜。じゃあ、さっき書いたのは```command```に入っているのは文字としての```"1"```だったから、これを整数にしてあげればいいから、こんな風に書けばいいんだね。」

```ruby:gets.rb
# コマンドを表示する
puts "1: 攻撃"
puts "2: 回復"
puts "3: 逃走"

# キーボードからの入力を受け取って、改行文字を噛みちぎる。
command = gets.chomp
# to_iメソッドで整数型に変換する
command = command.to_i
puts command

# コマンドに応じた処理
case command
when 1
  puts "勇者の攻撃"
when 2
  puts "勇者は回復呪文を唱えた"
when 3
  puts "勇者は逃げ出した"
end
```

```.to_i```メソッドを使って、バグが取れたはずなので、動かして見る。

![](https://storage.googleapis.com/zenn-user-upload/c33e1a0a4375-20240117.png)

「お〜、ちゃんと攻撃してくれるよ。」
「ええ、バグも取れて良かったわね。」
と、お姉さまは微笑んでくださる。

## メソッドチェーン
「メソッドチェーンという書き方もあるから、ついでに紹介しておくね。」
「それってどういう書き方なの？」
「さっきはこう書いたじゃない。」

```ruby
# キーボードからの入力を受け取って、改行文字を噛みちぎる。
command = gets.chomp
# to_iメソッドで整数型に変換する
command = command.to_i
```

「うん、そうだよ。```gets```でキーボードから読み込んで、それを```chomp```したのを```command```に代入するんだ。そして、```command```は文字列型だから、```to_i```メソッドで整数型に変換するんだよね。」
「ええ、そのとおり。そしてね。```gets```でキーボードから読み込んで、```chomp```して```to_i```で整数型にするのだから、続けて次のように書けるの。」

```ruby
# キーボードからの入力を受け取って、改行文字を噛みちぎったのを整数型に変換する
command = gets.chomp.to_i
```

「簡潔にかけたと思うけれど、どうかしら。」
「ほんとだ。とってもスッキリしてるよ。」
「ええ、```Ruby```では```.```でメソッドを呼び出せるのだけれど、メソッドを呼び出した後の結果を受けて、```.```を続けることでさらにメソッドを呼び出せるの。メソッドチェーンと呼ばれる由縁よ。」

## 定数の活用

「さてここで、定数を紹介するわ。」
「ていすうって？」
「定数、定まった数なことね。今みっくんは1番が攻撃で2番が回復、3番は逃げるって覚えているわよね。」
「もちろん、そうだよ。書いたばっかりだもの。覚えているよ。」
「ええ、だからコード中にも、```when 1 puts "勇者の攻撃"``` って書いてあるものね。」
「うん。何かあるの？」
「さて、半年経ったらどうかしら？ 1番は攻撃の事ってしっかり思い出せるかしら？」
「え〜、覚えてはちょっといないかもしれない。」
「ええそうね。もちろんそのすぐ後に勇者の攻撃って書いてあるから、1だったら攻撃なんだなっていうことはプログラムから読み取れるとは思うけれど、ちょっと理解するまでに時間がかかるわよね。そこで登場するのが定数よ。」
「どうやるの？」
「ええ、プログラム中で直接数字を書くのではなくて、こんな風にしてみるの。」

```ruby
# 定数の定義
ATTACK = 1
HEAL   = 2
ESCAPE = 3

# コマンドに応じた処理
case command
when ATTACK
  puts "勇者の攻撃"
when HEAL
  puts "勇者は回復呪文を唱えた"
when ESCAPE
  puts "勇者は逃げ出した"
end
```

「プログラム中では、数値を直接扱うのではなくて、その代わりに定数を使って見たの。わかりやすくなったと思うんだけれど、どうかしら。」
「うん。とってもいいよ。これなら半年経ってもATTACKは攻撃ってすぐ分かる！」
「みっくんに喜んでもらえて良かったわ。これなら他にもコマンドが増えても対応しやすいし、何かの事情で、10番を攻撃にしたくなっても変更も楽だからお薦めよ。プログラミングの定跡ってところかしら。」
「うん、遙香さん、ありがとう。」
「どういたしまして。」

##
「








「```1```が二回表示されているけれど・・・」
「そうね。二回表示されているわね。」
「う〜ん、二回目は ```puts menu```って書いたから、それの結果だと思うんだけれど、もしかして最初のキーボードから入力した```1```も表示されているってこと？」
「ええ、その通りよ。```gets```関数でキーボードから入力した```1```が表示されているの。」
「そうなんだ〜。なんかちょっとかっこ悪いし、消せないのかな〜。」
「ええ、そうね。ない方がすっきりしているし、かっこいいものね。」





https://github.com/Atelier-Mirai/Ruby_RPG/blob/master/rpg/rpg09.rb
